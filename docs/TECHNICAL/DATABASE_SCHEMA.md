# üóÑÔ∏è Database Schema (Firestore)

## Collections Overview

### Collection: users
User accounts and roles

```typescript
interface User {
  uid: string;                    // Firebase Auth UID
  email: string;                  // Email address
  displayName: string;            // Display name
  role: UserRole;                 // Role/permission level
  posNumber: 1 | 2 | null;       // POS assignment
  isActive: boolean;              // Active status
  createdAt: Timestamp;
  updatedAt: Timestamp;
  createdBy?: string;             // Creator UID
}

type UserRole = 
  | "owner"              // Owner
  | "manager"            // Manager
  | "assistant_manager"  // Assistant Manager
  | "cashier"            // Cashier
  | "auditor";           // Auditor
```

**Indexes**:
- email (Unique)
- role + isActive (Composite)

---

### Collection: daily_sales
Daily sales records - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (Auditor ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)

```typescript
interface DailySales {
  // Identification
  id: string;                              // Auto-generated by Firestore
  date: Timestamp;                         // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  
  // Cashier Information
  cashierId: string;                       // Firebase UID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏Ñ‡∏ä‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå
  cashierName: string;                     // ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏Ñ‡∏ä‡πÄ‡∏ä‡∏µ‡∏¢‡∏£‡πå
  
  // Sales Data (from POSPOS Receipt - Auditor ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
  posposData: {
    cashAmount: number;                    // ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (Cash)
    qrCode: number;                        // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ QR Code
    bankTransfer: number;                  // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (Bank)
    govProgram: number;                    // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ê (Government)
    totalSales: number;                    // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (AUTO CALC)
  };
  
  // Cash Reconciliation (‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î)
  cashReconciliation: {
    expectedAmount: number;                // ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏≤‡∏î‡πÑ‡∏ß‡πâ‡∏à‡∏≤‡∏Å POSPOS
    initialBalance: number;                // ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 2,000 ‡∏ö‡∏≤‡∏ó
    actualCashInDrawer: number;            // ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏ö‡πÑ‡∏î‡πâ
    difference: number;                    // ‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á = actualCashInDrawer - expectedAmount (AUTO)
    notes?: string;                        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á ‚â† 0)
  };
  
  // Status & Workflow
  status: SalesStatus;                     // Current status
  submittedAt: Timestamp;                  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Auditor ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  submittedBy: string;                     // Auditor UID
  
  auditedAt?: Timestamp;                   // ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Auditor ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (Week 4)
  auditedBy?: string;                      // Auditor UID
  auditNotes?: string;                     // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏à‡∏≤‡∏Å Auditor
  
  // System Timestamps
  createdAt: Timestamp;                    // Created timestamp
  updatedAt: Timestamp;                    // Last update timestamp
}

type SalesStatus = "submitted" | "audited" | "approved";
```

**Workflow**:
1. `submitted` - Auditor ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Task 3.1)
2. `audited` - Auditor ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (Week 4)
3. `approved` - Manager ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Week 4+)

**Indexes**:
- `date` (Ascending) - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter by date
- `date + status` (Composite) - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter by date + status
- `cashierId + date` (Composite) - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter by cashier
- `status` (Ascending) - ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö filter by status

**Security Rules**:
- Auditor: Can read/write own submissions
- Manager: Can read all, approve submissions
- Owner: Can read all, manage data

---

### Collection: service_transactions
Service income records

```typescript
interface ServiceTransaction {
  id: string;
  date: Timestamp;
  dailySalesId?: string;
  type: ServiceType;
  description: string;
  amount: number;
  recordedBy: string;
  recordedAt: Timestamp;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

type ServiceType = 
  | "money_transfer"
  | "withdrawal"
  | "bill_payment"
  | "other";
```

---

### Collection: daily_expenses
Daily expense records

```typescript
interface DailyExpense {
  id: string;
  date: Timestamp;
  category: DailyExpenseCategory;
  description: string;
  paymentMethod: "cash" | "transfer";
  amount: number;
  receipt?: string;               // URL to receipt image
  recordedBy: string;
  recordedAt: Timestamp;
  status: "draft" | "submitted" | "audited";
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

type DailyExpenseCategory = "stock_purchase" | "other";
```

---

### Collection: monthly_expenses
Monthly expense records (Owner only)

```typescript
interface MonthlyExpense {
  id: string;
  month: string;                  // Format: "2026-01"
  year: number;
  category: MonthlyExpenseCategory;
  description: string;
  amount: number;
  paymentDate: Timestamp;
  receipt?: string;
  recordedBy: string;             // Must be owner
  recordedAt: Timestamp;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

type MonthlyExpenseCategory = 
  | "rent" | "utilities_electric" | "utilities_water"
  | "internet" | "salary" | "overtime" | "vat" | "fuel" | "other";
```

---

### Collection: yearly_expenses
Yearly expense records (Owner only)

```typescript
interface YearlyExpense {
  id: string;
  year: number;
  category: YearlyExpenseCategory;
  description: string;
  amount: number;
  paymentDate: Timestamp;
  receipt?: string;
  recordedBy: string;             // Must be owner
  recordedAt: Timestamp;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}

type YearlyExpenseCategory = 
  | "income_tax" | "accounting_service" | "car_insurance" | "other";
```

---

### Collection: audit_logs
Audit verification records

```typescript
interface AuditLog {
  id: string;
  date: Timestamp;
  auditorId: string;
  auditorName: string;
  dailySalesId: string;
  
  actualCash: number;
  actualTransfer: {
    qrCode: number;
    bankAccount: number;
    govProgram: number;
    total: number;
  };
  
  systemCash: number;
  systemTransfer: {
    qrCode: number;
    bankAccount: number;
    govProgram: number;
    total: number;
  };
  
  difference: {
    cash: number;
    qrCode: number;
    bankAccount: number;
    govProgram: number;
    total: number;
  };
  
  notes?: string;
  status: "matched" | "discrepancy";
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

---

### Collection: cash_flow
Cash flow summary (auto-calculated)

```typescript
interface CashFlow {
  id: string;
  date: Timestamp;
  openingBalance: number;
  totalIncome: number;
  totalExpense: number;
  closingBalance: number;
  calculatedBy: string;
  calculatedAt: Timestamp;
  createdAt: Timestamp;
  updatedAt: Timestamp;
}
```

---

### Collection: system_logs
Audit trail for all actions

```typescript
interface SystemLog {
  id: string;
  timestamp: Timestamp;
  userId: string;
  userName: string;
  userRole: UserRole;
  action: SystemAction;
  resource: string;
  resourceId?: string;
  metadata?: Record<string, any>;
  ipAddress?: string;
  userAgent?: string;
  createdAt: Timestamp;
}

type SystemAction = 
  | "create" | "read" | "update" | "delete"
  | "login" | "logout" | "export" | "approve" | "reject";
```

---

**Source**: Extracted from Technical Specification  
**Last Updated**: Jan 7, 2026  
**Version**: 1.0  
